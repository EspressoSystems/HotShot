<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Ascends the leaf chain by traversing through the parent commitments of the proposal. We begin by obtaining the parent view, and if we are in a chain (i.e. the next view from the parent is one view newer), then we begin attempting to form the chain. This is a direct impl from HotStuff section 5:"><title>decide_from_proposal in hotshot_task_impls::helpers - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-492a78a4a87dcc01.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="hotshot_task_impls" data-themes="" data-resource-suffix="" data-rustdoc-version="1.82.0 (f6e511eec 2024-10-15)" data-channel="1.82.0" data-search-js="search-a99f1315e7cc5121.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-921df33f47b8780c.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-3b12f09e550e0385.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../hotshot_task_impls/index.html">hotshot_<wbr>task_<wbr>impls</a><span class="version">0.5.84</span></h2></div><div class="sidebar-elems"><h2><a href="index.html">In hotshot_<wbr>task_<wbr>impls::<wbr>helpers</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Function <a href="../index.html">hotshot_task_impls</a>::<wbr><a href="index.html">helpers</a>::<wbr><a class="fn" href="#">decide_from_proposal</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../src/hotshot_task_impls/helpers.rs.html#378-503">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub async fn decide_from_proposal&lt;TYPES: <a class="trait" href="../../hotshot_types/traits/node_implementation/trait.NodeType.html" title="trait hotshot_types::traits::node_implementation::NodeType">NodeType</a>&gt;(
    proposal: &amp;<a class="struct" href="../../hotshot_types/data/struct.QuorumProposalWrapper.html" title="struct hotshot_types::data::QuorumProposalWrapper">QuorumProposalWrapper</a>&lt;TYPES&gt;,
    consensus: <a class="struct" href="../../hotshot_types/consensus/struct.OuterConsensus.html" title="struct hotshot_types::consensus::OuterConsensus">OuterConsensus</a>&lt;TYPES&gt;,
    existing_upgrade_cert: <a class="struct" href="https://doc.rust-lang.org/1.82.0/alloc/sync/struct.Arc.html" title="struct alloc::sync::Arc">Arc</a>&lt;RwLock&lt;<a class="enum" href="https://doc.rust-lang.org/1.82.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="type" href="../../hotshot_types/simple_certificate/type.UpgradeCertificate.html" title="type hotshot_types::simple_certificate::UpgradeCertificate">UpgradeCertificate</a>&lt;TYPES&gt;&gt;&gt;&gt;,
    public_key: &amp;TYPES::<a class="associatedtype" href="../../hotshot_types/traits/node_implementation/trait.NodeType.html#associatedtype.SignatureKey" title="type hotshot_types::traits::node_implementation::NodeType::SignatureKey">SignatureKey</a>,
    with_epochs: <a class="primitive" href="https://doc.rust-lang.org/1.82.0/std/primitive.bool.html">bool</a>,
    membership: &amp;<a class="struct" href="https://doc.rust-lang.org/1.82.0/alloc/sync/struct.Arc.html" title="struct alloc::sync::Arc">Arc</a>&lt;RwLock&lt;TYPES::<a class="associatedtype" href="../../hotshot_types/traits/node_implementation/trait.NodeType.html#associatedtype.Membership" title="type hotshot_types::traits::node_implementation::NodeType::Membership">Membership</a>&gt;&gt;,
) -&gt; <a class="struct" href="struct.LeafChainTraversalOutcome.html" title="struct hotshot_task_impls::helpers::LeafChainTraversalOutcome">LeafChainTraversalOutcome</a>&lt;TYPES&gt;</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Ascends the leaf chain by traversing through the parent commitments of the proposal. We begin
by obtaining the parent view, and if we are in a chain (i.e. the next view from the parent is
one view newer), then we begin attempting to form the chain. This is a direct impl from
<a href="https://arxiv.org/pdf/1803.05069">HotStuff</a> section 5:</p>
<blockquote>
<p>When a node b* carries a QC that refers to a direct parent, i.e., b*.justify.node = b*.parent,
we say that it forms a One-Chain. Denote by b’’ = b*.justify.node. Node b* forms a Two-Chain,
if in addition to forming a One-Chain, b’‘.justify.node = b’‘.parent.
It forms a Three-Chain, if b’’ forms a Two-Chain.</p>
</blockquote>
<p>We follow this exact logic to determine if we are able to reach a commit and a decide. A commit
is reached when we have a two chain, and a decide is reached when we have a three chain.</p>
<h2 id="example"><a class="doc-anchor" href="#example">§</a>Example</h2>
<p>Suppose we have a decide for view 1, and we then move on to get undecided views 2, 3, and 4. Further,
suppose that our <em>next</em> proposal is for view 5, but this leader did not see info for view 4, so the
justify qc of the proposal points to view 3. This is fine, and the undecided chain now becomes
2-3-5.</p>
<p>Assuming we continue with honest leaders, we then eventually could get a chain like: 2-3-5-6-7-8. This
will prompt a decide event to occur (this code), where the <code>proposal</code> is for view 8. Now, since the
lowest value in the 3-chain here would be 5 (excluding 8 since we only walk the parents), we begin at
the first link in the chain, and walk back through all undecided views, making our new anchor view 5,
and out new locked view will be 6.</p>
<p>Upon receipt then of a proposal for view 9, assuming it is valid, this entire process will repeat, and
the anchor view will be set to view 6, with the locked view as view 7.</p>
<h2 id="panics"><a class="doc-anchor" href="#panics">§</a>Panics</h2>
<p>If the leaf chain contains no decided leaf while reaching a decided view, which should be
impossible.</p>
</div></details></section></div></main></body></html>