# NOTE run from parent directory
FROM ubuntu:jammy

# assuming this is built already
COPY target/release/examples/multi-machine-libp2p /bin/multi-machine-libp2p

# total number of nodes: regular + bootstrap
ENV NUM_NODES="20"

# number of bootstrap
ENV NUM_BOOTSTRAP="7"

# number of transactions each round
ENV NUM_TXN_PER_ROUND="10"

# the index of the node
ENV NODE_IDX="0"

# how long to run for before dying
# in minutes
ENV ONLINE_TIME="60"

# the seed to generate phaselock keys with
ENV SEED="1234"

# logging
ENV RUST_LOG="warn"

# log format. JSON no ansi
ENV RUST_LOG_FORMAT="json"

ENV PORT="9000"

# mesh params
ENV BOOTSTRAP_MESH_N_HIGH="50"
ENV BOOTSTRAP_MESH_N_LOW="10"
ENV BOOTSTRAP_MESH_OUTBOUND_MIN="5"
ENV BOOTSTRAP_MESH_N="15"
ENV MESH_N_HIGH="15"
ENV MESH_N_LOW="8"
ENV MESH_OUTBOUND_MIN="4"
ENV MESH_N="12"

# in seconds
ENV NEXT_VIEW_TIMEOUT="30"

# in seconds
ENV PROPOSE_MIN_ROUND_TIME="1"

# in seconds
ENV PROPOSE_MAX_ROUND_TIME="10"

EXPOSE 9000

CMD ["sh", "-c", "NUM_NODES=${NUM_NODES} NUM_BOOTSTRAP=${NUM_BOOTSTRAP} NUM_TXN_PER_ROUND=${NUM_TXN_PER_ROUND} NODE_IDX=${NODE_IDX} ONLINE_TIME=${ONLINE_TIME} SEED=${SEED} RUST_LOG=${RUST_LOG} BOUND_ADDR=0.0.0.0:${PORT} SEED=${SEED} BOOTSTRAP_MESH_N_HIGH=${BOOTSTRAP_MESH_N_HIGH} BOOTSTRAP_MESH_N_LOW=${BOOTSTRAP_MESH_N_LOW} BOOTSTRAP_MESH_OUTBOUND_MIN=${BOOTSTRAP_MESH_OUTBOUND_MIN} BOOTSTRAP_MESH_N=${BOOTSTRAP_MESH_N} MESH_N_HIGH=${MESH_N_HIGH} MESH_N_LOW=${MESH_N_LOW} MESH_OUTBOUND_MIN=${MESH_OUTBOUND_MIN} MESH_N=${MESH_N} NEXT_VIEW_TIMEOUT=${NEXT_VIEW_TIMEOUT} PROPOSE_MIN_ROUND_TIME=${PROPOSE_MIN_ROUND_TIME} PROPOSE_MAX_ROUND_TIME=${PROPOSE_MAX_ROUND_TIME} /bin/multi-machine-libp2p"]
